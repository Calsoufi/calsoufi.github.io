<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- Reference to the Bing Maps SDK -->
    <script type='text/javascript'
    src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=Aj3FRa0xCnDa-nApre6YJSYnFPZU270tWHtgyrOeJ7oCpa_tGccKmPXMiEHULED8'
    async defer></script>

<script type='text/javascript'>
    fetch('./places.json')
        .then(response => response.json())
        .then(data => {
            var map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
                credentials: 'Aj3FRa0xCnDa-nApre6YJSYnFPZU270tWHtgyrOeJ7oCpa_tGccKmPXMiEHULED8',
                zoom: 4
            });



            var pushpins = [];
            var visitedCount = {};
            var activeInfobox;

            for (var i = 0; i < data.length; i++) {
                var location = new Microsoft.Maps.Location(data[i].latitude += (Math.random() - 0.5) * 0.010, data[i].longitude += (Math.random() - 0.5) * 0.010);
                var locationData = data[i];
                var color = data[i].countrycolor;


                var pin = new Microsoft.Maps.Pushpin(location, {
                    color: color,
                    anchor: new Microsoft.Maps.Point(12, 39),
                    title: locationData.city
                });

                Microsoft.Maps.Events.addHandler(pin, 'click', (function (locationData) {
                    return function (e) {
                        var infobox = new Microsoft.Maps.Infobox(e.target.getLocation(), {
                            title: locationData.city,
                            description: 'Date: ' + locationData.startdate + '<br>Country: ' + locationData.country,
                            htmlContent: '<div id="textdescription" style="background-color: ' + locationData.countrycolor + '; height: 100px; width: 100px;"> Date: ' + locationData.startdate + '<br>Country: ' + locationData.country + '</div>',
                            visible: true
                        });

                        if (activeInfobox) {
                            activeInfobox.setOptions({ visible: false });
                        }

                        activeInfobox = infobox;

                        map.entities.push(infobox);
                    };
                })(locationData));

                pushpins.push(pin);
            }

            //Load the Clustering module.
            Microsoft.Maps.loadModule("Microsoft.Maps.Clustering", function () {


                //Create a ClusterLayer and add it to the map.
                clusterLayer = new Microsoft.Maps.ClusterLayer(pushpins);
                map.layers.insert(clusterLayer);
            });
        })
        .catch(error => console.error(error));
    </script>
</head>

<body>
    <h1>Hello World</h1>
    <p>Yolo1.</p>
    <div id="myMap" style="position:absolute; top:0; left:0; width:100%; height:100%;"></div>
</body>

</html>